<script id="ABConvert-url-redirect-test-v1">
var abconvertThemeTestLiquidVariables = { abconvertDesignMode:{{ request.design_mode }}
};

Object.keys(abconvertThemeTestLiquidVariables).forEach(function(key) { window[key] =
abconvertThemeTestLiquidVariables[key]; });
var abconvertUrlRedirectTestDictV1 = {"experiments":[{"experimentId":"67593e8908d95496c7703588","testGroups":[{"name":"Control group (Variant A)","percentage":50,"url":"/products/everyday-bb-tasche-q1","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593e8908d95496c7703589","testProducts":[]},{"name":"Variant B","percentage":50,"url":"/products/everyday-bb-tasche-q2","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593e8908d95496c770358a","testProducts":[]}],"triggerConditions":[[{"conditionType":"page_url","condition":"match_exactly","value":"/products/everyday-bb-tasche-q1","_id":"67593e8908d95496c770358b"}]],"perserveQueryString":true,"redirectType":"trigger_always","urlDict":{"/products/everyday-bb-tasche-q1":true,"/products/everyday-bb-tasche-q2":true},"startTime":"2024-12-11T07:26:01.270Z"},{"experimentId":"67593ebc50a9651a8d8f045e","testGroups":[{"name":"Control group (Variant A)","percentage":50,"url":"/products/everyday-bb-tasche-zipper-version-q1","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593ebc50a9651a8d8f045f","testProducts":[]},{"name":"Variant B","percentage":50,"url":"/products/everyday-bb-tasche-zipper-version-q2","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593ebc50a9651a8d8f0460","testProducts":[]}],"triggerConditions":[[{"conditionType":"page_url","condition":"match_exactly","value":"/products/everyday-bb-tasche-zipper-version-q1","_id":"67593ebc50a9651a8d8f0461"}]],"perserveQueryString":true,"redirectType":"trigger_always","urlDict":{"/products/everyday-bb-tasche-zipper-version-q1":true,"/products/everyday-bb-tasche-zipper-version-q2":true},"startTime":"2024-12-11T07:26:52.116Z"},{"experimentId":"67593ee008d95496c770fb9d","testGroups":[{"name":"Control group (Variant A)","percentage":50,"url":"/products/scarlett-distressed-leather-tote-q1","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593ee008d95496c770fb9e","testProducts":[]},{"name":"Variant B","percentage":50,"url":"/products/scarlett-distressed-leather-tote-q2","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593ee008d95496c770fb9f","testProducts":[]}],"triggerConditions":[[{"conditionType":"page_url","condition":"match_exactly","value":"/products/scarlett-distressed-leather-tote-q1","_id":"67593ee008d95496c770fba0"}]],"perserveQueryString":true,"redirectType":"trigger_always","urlDict":{"/products/scarlett-distressed-leather-tote-q1":true,"/products/scarlett-distressed-leather-tote-q2":true},"startTime":"2024-12-11T07:27:28.960Z"},{"experimentId":"67593f09ab80c572743e88f2","testGroups":[{"name":"Control group (Variant A)","percentage":50,"url":"/products/scarlett-distressed-leather-tote-zipper-version-q1","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593f09ab80c572743e88f3","testProducts":[]},{"name":"Variant B","percentage":50,"url":"/products/scarlett-distressed-leather-tote-zipper-version-q2","paymentCustomization":[],"deliveryCustomization":[],"checkoutUICustomization":[],"shippingCost":2,"profitMargin":30,"_id":"67593f09ab80c572743e88f4","testProducts":[]}],"triggerConditions":[[{"conditionType":"page_url","condition":"match_exactly","value":"/products/scarlett-distressed-leather-tote-zipper-version-q1","_id":"67593f09ab80c572743e88f5"}]],"perserveQueryString":true,"redirectType":"trigger_always","urlDict":{"/products/scarlett-distressed-leather-tote-zipper-version-q1":true,"/products/scarlett-distressed-leather-tote-zipper-version-q2":true},"startTime":"2024-12-11T07:28:09.738Z"}]};
 window.abconvertUrlRedirectTestDictV1 = abconvertUrlRedirectTestDictV1;
(()=>{"use strict";const e="match_exactly",t="match_regex_exactly",o="contains",r="ends_with",n="starts_with",i="not_match_exactly",a="not_match_regex_exactly",c="not_contains",s="not_ends_with",d="not_starts_with",l="query_string",u=[/Googlebot/,/Googlebot-Image/,/Googlebot-Video/,/Googlebot-News/,/Storebot-Google/,/Google-InspectionTool/,/GoogleOther/,/Google-Extended/,/APIs-Google/,/AdsBot-Google-Mobile/,/AdsBot-Google/,/Mediapartners-Google/,/Google-Safety/,/FeedFetcher-Google/,/GoogleProducer/,/Bingbot/,/Slurp/,/DuckDuckBot/,/Baiduspider/,/YandexBot/,/facebot/,/Twitterbot/],g="https://app.abconvert.io";async function h(){localStorage.getItem("abconvert-country")||await async function(){const e=await fetch(`${g}/api/public/get-country-code`,{method:"GET",mode:"cors"}),t=(await e.json()).countryCode;t&&(console.log("successfully set country code: ",t),localStorage.setItem("abconvert-country",t))}()}function w(){return localStorage.getItem("abconvert-country")}const f={NEW:"new",RETURNING:"returning",ALL:"all"};function m(e){for(var t=e+"=",o=document.cookie.split(";"),r=0;r<o.length;r++){for(var n=o[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null}function p(e,t,o){var r,n=new Date;n.setTime(n.getTime()+o),r="; expires="+n.toUTCString(),document.cookie=e+"="+(t||"")+r+"; path=/"}function b(){let e=m("abconvert-landing-page");return e||(e=window.location.pathname,p("abconvert-landing-page",e,18e5)),e}function y(){let e=m("abconvert-session");return e||(e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),p("abconvert-session",e,18e5)),e}function v(e){const t=(new Date).valueOf(),o=localStorage.getItem("abconvert-first-visit-time")?Number(localStorage.getItem("abconvert-first-visit-time")):t;return localStorage.getItem("abconvert-first-visit-time")||localStorage.setItem("abconvert-first-visit-time",t.toString()),o>(e=new Date(e).valueOf())?f.NEW:f.RETURNING}let I,x,S=0,R=0,T=!1;const U=()=>{T?(T=!1,x=(new Date).getTime(),R+=(x-I)/1e3):(T=!0,I=(new Date).getTime())};function N(e,t,o,r,n){const i=(new Date).getTime(),a=window.location.pathname.toString(),c=b();m(`abconvert-${t}-test-stay-time-recorded-${o}`)||(p(`abconvert-${t}-test-stay-time-recorded-${o}`,!0,18e5),setInterval((()=>{(new Date).getTime()-i>39e3&&U()}),39e3),window.addEventListener("beforeunload",(async()=>{const t=y(),s=(new Date).getTime(),d=(s-i)/1e3,l=(s-i)/1e3-S/1e3-R;fetch(e,{method:"POST",body:JSON.stringify({stayingTime:d,stayingTimeAdjusted:l,sessionId:t,experimentId:o,groupIndex:r,visitorType:v(n),pathName:a,landingPage:c}),keepalive:!0})})))}function O(e,t,o,r){const n=window.location.pathname.toString(),i=b();window.addEventListener("click",(a=>{if("A"===a.target.tagName){const c=a.target.getAttribute("href");console.log(c);const s=y();fetch(e,{method:"POST",body:JSON.stringify({sessionId:s,experimentId:t,groupIndex:o,link:c,visitorType:v(r),pathName:n,landingPage:i}),keepalive:!0})}}))}function L(e,t,o,r){const n=window.location.pathname.toString(),i=b();let a=!1;window.addEventListener("scroll",(()=>{a=!0})),window.addEventListener("click",(()=>{a=!0})),window.addEventListener("beforeunload",(async()=>{if(!a){const a=y();fetch(e,{method:"POST",body:JSON.stringify({sessionId:a,experimentId:t,groupIndex:o,visitorType:v(r),pathName:n,landingPage:i}),keepalive:!0})}}))}async function G(e,t,o,r){const n=y(),i=window.location.pathname.toString(),a=b();fetch(e,{method:"POST",body:JSON.stringify({sessionId:n,experimentId:t,groupIndex:o,visitorType:v(r),pathName:i,landingPage:a}),keepalive:!0})}window.addEventListener("scroll",(()=>{S+=1.8,U()})),(async()=>{function f(){const e=new URLSearchParams(location.search),t=e.get("preview"),o=e.get("countryCode");return o&&window.sessionStorage.setItem("abconvert-country",o),t&&!isNaN(Number(t))?(window.sessionStorage.setItem("abconvert-preview-number",t),t):window.sessionStorage.getItem("abconvert-preview-number")}function m(e){let t,o=f();return t=o&&!isNaN(Number(o))?Number(o)>=e.length?0:Number(o):function(e){const t=function(){let e=localStorage.getItem("abconvert-seed");return null==e&&(e=Math.floor(100*Math.random()).toString(),localStorage.setItem("abconvert-seed",e)),e}();let o,r=0;for(o=0;o<e.length;++o)if(r+=e[o].percentage,Number(t)<r)return o;return o}(e),t}function p(){const e=f();return e&&!isNaN(Number(e))}function y(e){for(var t=e+"=",o=document.cookie.split(";"),r=0;r<o.length;r++){for(var n=o[r];" "==n.charAt(0);)n=n.substring(1,n.length);if(0==n.indexOf(t))return n.substring(t.length,n.length)}return null}function I(u){const g=window.location.pathname,h=window.location.search,w=g+h,{conditionType:f,condition:m,value:p}=u;let b;switch(f){case"page_url":b=g;break;case"page_url_with_query_string":b=w;break;case l:b=h;break;default:return!1}return f===l?function(l,u,g){let h=decodeURI(g);const w=new URLSearchParams(h);switch(l){case e:const l=new URLSearchParams(decodeURI(u));let g=!0;for(let[e,t]of l)if(!w.has(e)||w.get(e)!==t){g=!1;break}return g&&w.forEach(((e,t)=>{l.has(t)||(g=!1)})),g;case t:return new RegExp(u).test(h);case o:const f=new URLSearchParams(u);for(let[e,t]of f)if(!w.has(e)||w.get(e)!==t)return!1;return!0;case n:return h.startsWith(decodeURI(u));case r:return h.endsWith(decodeURI(u));case i:const m=new URLSearchParams(decodeURI(u));let p=!1;for(let[e,t]of m)if(!w.has(e)||w.get(e)!==t){p=!0;break}return p||w.forEach(((e,t)=>{m.has(t)||(p=!0)})),p;case a:return!new RegExp(u).test(h);case c:const b=new URLSearchParams(u);for(let[e,t]of b)if(w.has(e)&&w.get(e)===t)return!1;return!0;case d:return!h.startsWith(decodeURI(u));case s:return!h.endsWith(decodeURI(u));default:return!1}}(m,p,b):function(l,u,g){let h=decodeURI(g);switch(l){case e:return decodeURI(u)===h;case t:return new RegExp(u).test(h);case o:return h.includes(decodeURI(u));case n:return h.startsWith(decodeURI(u));case r:return h.endsWith(decodeURI(u));case i:return decodeURI(u)!==h;case a:return!new RegExp(u).test(h);case c:return!h.includes(decodeURI(u));case d:return!h.startsWith(decodeURI(u));case s:return!h.endsWith(decodeURI(u));default:return!1}}(m,p,b)}function x(e){if(0===e.length)return!1;let t=e[0],o=e.slice(1).filter((e=>"and"===e.logic)),r=e.slice(1).filter((e=>"or"===e.logic)),n=0===o.length||o.every((e=>I(e))),i=r.length>0&&r.some((e=>I(e)));return(I(t)||i)&&n}function S(e){for(let t of e)if(x(t))return!0;return!1}const R=()=>{let e;localStorage.getItem("shopURL")||window.Shopify&&window.Shopify.shop&&(e=window.Shopify.shop,localStorage.setItem("shopURL",e),console.log("[LOG] Redirect test: set shop url"))},T=async function(e,t){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;const r={method:t,mode:"cors",headers:{"Content-Type":"application/json"}};o&&(r.body=JSON.stringify(o));let n=150,i=0;for(;i<3;)try{const t=await fetch(e,r);if(t.ok)return t.json();throw new Error(await t.json())}catch(e){if(n*=2,i+=1,i>=3)throw e;await new Promise((e=>setTimeout(e,n)))}throw new Error("API Error")};async function U(e){let{experimentId:t,groupIndex:o}=e;for(let e=0;e<10;e++){await h(),console.log("[LOG] Update cart attirbutes: ",{experimentId:t,groupIndex:o});const e=await T((window?.Shopify?.routes?.root??"/")+"cart.js","GET");console.log("[LOG] Original cart attributes: ",e.attributes);let r=JSON.parse(JSON.stringify(e.attributes)),n=e.attributes;n["abconvert-url-redirect"]&&(n["abconvert-url-redirect"]=n["abconvert-url-redirect"].filter((e=>JSON.parse(e).experimentId!=t)));const i={"abconvert-url-redirect":n["abconvert-url-redirect"]?[...n["abconvert-url-redirect"],JSON.stringify({experimentId:t,groupIndex:o})]:[JSON.stringify({experimentId:t,groupIndex:o})],abconvertCountry:w(),abconvertSearchParams:y("abconvert-search-params")??""};if(console.log("[LOG] Original cart attributes: ",n["abconvert-url-redirect"]),console.log("[LOG] New cart attributes: ",i["abconvert-url-redirect"]),JSON.stringify(r["abconvert-url-redirect"])==JSON.stringify(i["abconvert-url-redirect"]))break;console.log("[LOG] New cart attributes: ",i);const a={"Content-Type":"application/json"},c=(window?.Shopify?.routes?.root??"/")+"cart/update.js",s=JSON.stringify({attributes:i});(await fetch(c,{method:"POST",headers:a,body:s})).ok?console.log("[LOG] Update cart attributes successfully"):console.log("[LOG] Update cart attributes failed")}}function E(e){const t=new URL(e,window.location.origin);return t.searchParams.delete("preview_theme_id"),t.origin+t.pathname+t.search+t.hash}function _(e,t){const o=new URLSearchParams(e);return new URLSearchParams(t).forEach(((e,t)=>{o.has(t)||o.set(t,e)})),o.toString()}console.log("[ABConvert] Running ABConvert URL redirect test  2.0.0 - with update cart attribute ");try{if(window.Shopify?.designMode||window.abconvertDesignMode)return;b(),localStorage.getItem("abconvert-user-seed")||localStorage.setItem("abconvert-user-seed","0"),R(),document.addEventListener("DOMContentLoaded",R),async function(){(()=>{const e=navigator.userAgent;return u.some((t=>t.test(e)))})()||window.abconvertUrlRedirectTestDictV1&&(window.abconvertUrlRedirectTestDictV1.fetchCountryCode&&await h(),function(e){for(let t of e){const{experimentId:e,triggerConditions:o,perserveQueryString:r,redirectType:n,isFilteredByCountry:i,filteredCountries:a}=t;if(i){const e=w();if(!e)continue;if(a?.length&&!a.includes(e))continue}const c=`abconvert-url-redirect-test-${e}`;if(t.selectedVistorType&&t.selectedVistorType!=v(t.startTime))return;if(console.log(t.selectedVistorType,v(t.startTime)),("trigger_once"!==n||!localStorage.getItem(c))&&S(o)){const o=t.testGroups,n=m(o),i=new URL(decodeURI(o[n].url),window.location.origin),a=t.startTime;p()||localStorage.getItem(c)||localStorage.setItem(c,JSON.stringify({experimentId:e,groupIndex:n,startTime:a}));let s=i.pathname+i.hash;if(r){const e=_(window.location.search,i.search);s=i.pathname+(e?"?"+e:"")+i.hash}else s=i.pathname+i.search+i.hash;window.Shopify?.routes?.root&&"/"!=window.Shopify.routes.root&&(s.includes(window.Shopify.routes.root)||(s=window.Shopify.routes.root+s));const d=window.location.origin+s;if(E(window.location.href)!==E(d)){window.location.href=s;break}}}}(window.abconvertUrlRedirectTestDictV1.experiments),function(e){const t=g+"/api/analytics/redirect/originalview",o=g+"/api/analytics/redirect/click",r=g+"/api/analytics/redirect/bounce",n=g+"/api/analytics/redirect/staying-time";for(let i of e){const{experimentId:e,urlDict:a}=i,c=decodeURI(window.location.pathname),s=decodeURI(window.location.href);if((a[decodeURI(window.location.pathname)]||a[window.location.pathname])&&(!i.selectedVistorType||i.selectedVistorType===v(i.startTime))){const a=localStorage.getItem(`abconvert-url-redirect-test-${e}`),d=y(`abconvert-url-redirect-test-stay-time-recorded-${e}`);if(a){const{groupIndex:l}=JSON.parse(a);U({experimentId:e,groupIndex:l}),decodeURI(i.testGroups[l].url)!==c&&E(decodeURI(i.testGroups[l].url))!==E(s)||(G(t,e,l,i.startTime),O(o,e,l,i.startTime),L(r,e,l,i.startTime),d||N(n,"url-redirect",e,l,i.startTime))}}}}(window.abconvertUrlRedirectTestDictV1.experiments))}()}catch(e){console.log("[ABConvert] URL redirect test error: ",e.message)}})()})();
</script>